<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../bootstrap-5.0.2-dist/css/bootstrap.min.css">
    <script src="../js/jquery-3.7.1.min.js"></script>
    <title>Quản lý tài chính</title>
    <link href="https://cdn.jsdelivr.net/gh/eliyantosarage/font-awesome-pro@main/fontawesome-pro-6.5.1-web/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/index.css">
    <script src="../bootstrap-5.0.2-dist/js/bootstrap.min.js"></script>
    <script src="../js/index.js"></script>
    <script src="https://example.com/fontawesome/v6.5.1/js/all.js" data-auto-replace-svg="nest"></script>
    <style>
        .form-group button {
            width: 70%;
            
            border-radius: 20px;
        }

        .flash {
            display: none;
        }
        @media only screen and (max-width: 1024px){
            .logo {
                display: none;
            }
        }
        input {
            border-radius: 20px;
            width: 100%;
            padding-left: 15px;
            border: none;
            background-color: rgb(222, 228, 244);
        }
        section{
            background-color: #e6e6e6;
            height: 100vh;
        }
        .form-login{
            background-color: #fff;
            border-radius: 10%;
        }
    </style>
</head>
<body>
    <!-- Form Login -->
    <section id="login-form">
        <div class="container">
            <div class="row">
                <div class="col-xl-7 ">
                    <img src="../img/logo.png" alt=""  class="text-center logo" width="600px" height="400px">
                </div>
                <div class="col-xl-5 mt-3 form-login">
                    <div class="form-container">
                        <div class="form-header  text-center">
                            <img src="../img/logo-no-background.png" style="margin-top: 70px" height="70px" alt="" >
                        </div>
                        <div class="alert alert-danger my-1 flash" role="alert" id="flashMsg"></div>
                        <div class="form-body">
                            <form action="/" class="d-flex flex-column justify-content-center">
                                <div class="form-group mt-5">
                                    <div class="field d-flex">
                                        <span><i class="far fa-envelope"></i></span>
                                        <input id="txt_email" type="email" class="" id="email" placeholder="Nhập email">
                                    </div>
                                </div>
                                <div class="form-group mt-3">
                                    <div class="field d-flex">
                                        <span><i class="fas fa-lock"></i></span>
                                        <input id="txt_password" type="password" class="" id="password" aria-describedby="passwordHelpBlock" placeholder="Nhập mật khẩu">
                                    </div>
                                </div>
                                <div class="form-group d-flex justify-content-between pt-2">
                                    <span>
                                        
                                    </span>
                                    <a href="#" class="forgot-password text-decoration-none">Quên mật khẩu</a>
                                </div>
                                <div class="form-group d-flex mr-auto justify-content-center flex-column align-items-center">
                                    <button type="button" class="btn text-white mt-3" id="btn_login" style="background-color: #3c91e7;">Đăng nhập</button>
                                    <button type="button" class="btn btn-danger mt-2" id="btn_login_google"> 
                                        <a  class="text-decoration-none text-white" href="" id="login_google">
                                            <i class="fa-brands fa-google"></i>
                                            Đăng nhập với Google
                                        </a>

                                    </button>
                                </div>
                                <p class="text-center pt-2 ">Bạn chưa có tài khoản? <span><a href="../pages/SignUp.html" class="text-decoration-none">Đăng kí</a></span></p>
                                
                            </form>
                            
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        $(document).ready(function () {
            $("#btn_login_google").click(function () {
                window.location("https://www.google.com/search?q=d%E1%BB%8Bch&sca_esv=3cbe9f3cb5d0638a&sxsrf=ACQVn08YAffMsLzWKNXWHW9QpyEXDAqVxw%3A1706887712174&source=hp&ei=IAq9ZaqYCPfi1e8PruO92A0&iflsig=ANes7DEAAAAAZb0YMH26NTLgTvvmMCaS7aJa9biOhgzo&udm=&oq=&gs_lp=Egdnd3Mtd2l6IgAqAggBMgcQIxjqAhgnMgcQIxjqAhgnMgcQIxjqAhgnMgcQIxjqAhgnMgcQIxjqAhgnMgcQIxjqAhgnMgcQIxjqAhgnMgcQIxjqAhgnMgcQIxjqAhgnMgcQIxjqAhgnSJsNUABYAHABeACQAQCYAQCgAQCqAQC4AQHIAQCoAgo&sclient=gws-wiz");
            });

            $("#btn_login").click(function () {
                if ($("#txt_username").val() == "" || $("#txt_password").val() == "") {
                    alert("Vui lòng nhập đầy đủ thông tin");
                    
                }
                else {
                    $("#flashMsg").empty("")
                    var email = $("#txt_email").val();
                    var password = $("#txt_password").val();
                    $.ajax({
                        url: "http://localhost:3001/api/user/login",
                        type: "POST",
                        data: JSON.stringify({email: email, password: password}),
                        contentType: 'application/json',
                        withCredentials: true,
                        success: function (data) {
                            $("#flashMsg").addClass('flash');
                            window.location.href = "/";
                        },
                        error: function (request, status, error) {
                            $("#txt_password").val("");
                            $("#flashMsg").removeClass('flash');
                            $("#flashMsg").append(JSON.parse(request.responseText).message)
                        }
                    });
                }
            });
        });


        const getGoogleUrl = () => {
            const url = "https://accounts.google.com/o/oauth2/v2/auth";
            const query = {
                client_id:
                    "1079737502847-ettbdto8bntesbgoqts1ie73sp4b6l68.apps.googleusercontent.com",
                redirect_uri: "http://localhost:3001/api/user/login-google",
                response_type: "code",
                scope: [
                    "https://www.googleapis.com/auth/userinfo.profile",
                    "https://www.googleapis.com/auth/userinfo.email",
                ].join(" "),
                prompt: "consent",
                access_type: "offline",
            };
            const queryString = new URLSearchParams(query).toString();
            return `${url}?${queryString}`;
        };

        const urlGoogle = getGoogleUrl();
        console.log(urlGoogle);
        var test = document.getElementById("login_google");
        test.href = urlGoogle;
    </script>

    
</body>
</html>